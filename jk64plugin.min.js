function jk64plugin_geocode(e,i){i.geocode({address:$v(e.geocodeItem),componentRestrictions:""!==e.country?{country:e.country}:{}},function(i,n){if(n===google.maps.GeocoderStatus.OK){var a=i[0].geometry.location;apex.debug(e.regionId+" geocode ok"),e.map.setCenter(a),e.map.panTo(a),e.markerZoom&&e.map.setZoom(e.markerZoom),jk64plugin_userPin(e,a.lat(),a.lng())}else apex.debug(e.regionId+" geocode was unsuccessful for the following reason: "+n)})}function jk64plugin_repPin(e,i){var n=new google.maps.Marker({map:e.map,position:new google.maps.LatLng(i.lat,i.lng),title:i.name,icon:i.icon});google.maps.event.addListener(n,"click",function(){apex.debug(e.regionId+" repPin clicked "+i.id),e.iw?e.iw.close():e.iw=new google.maps.InfoWindow,e.iw.setOptions({content:i.info}),e.iw.open(e.map,this),e.map.panTo(this.getPosition()),e.markerZoom&&e.map.setZoom(e.markerZoom),""!==e.idItem&&$s(e.idItem,i.id),apex.jQuery("#"+e.regionId).trigger("markerclick",{map:e.map,id:i.id,name:i.name,lat:i.lat,lng:i.lng})}),e.reppin||(e.reppin=[]),e.reppin.push({id:i.id,marker:n})}function jk64plugin_repPins(e){for(var i=0;i<e.mapdata.length;i++)jk64plugin_repPin(e,e.mapdata[i])}function jk64plugin_click(e,i){for(var n=!1,a=0;a<e.reppin.length;a++)if(e.reppin[a].id==i){new google.maps.event.trigger(e.reppin[a].marker,"click"),n=!0;break}n||apex.debug(e.regionId+" id not found:"+i)}function jk64plugin_setCircle(e,i){if(""!==e.distItem)if(e.distcircle)apex.debug(e.regionId+" move circle"),e.distcircle.setCenter(i),e.distcircle.setMap(e.map);else{var n=parseFloat($v(e.distItem));apex.debug(e.regionId+" create circle radius="+n),e.distcircle=new google.maps.Circle({strokeColor:"#5050FF",strokeOpacity:.5,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.05,clickable:!1,editable:!0,map:e.map,center:i,radius:1e3*n}),google.maps.event.addListener(e.distcircle,"radius_changed",function(i){var n=e.distcircle.getRadius()/1e3;apex.debug(e.regionId+" circle radius changed "+n),$s(e.distItem,n),jk64plugin_refreshMap(e)}),google.maps.event.addListener(e.distcircle,"center_changed",function(i){var n=e.distcircle.getCenter(),a=n.lat()+","+n.lng();apex.debug(e.regionId+" circle center changed "+a),""!==e.syncItem&&($s(e.syncItem,a),jk64plugin_refreshMap(e))})}}function jk64plugin_userPin(e,i,n){if(null!==i&&null!==n){var a=e.userpin?e.userpin.getPosition():new google.maps.LatLng(0,0);if(i==a.lat()&&n==a.lng())apex.debug(e.regionId+" userpin not changed");else{var t=new google.maps.LatLng(i,n);e.userpin?(apex.debug(e.regionId+" move existing pin to new position on map "+i+","+n),e.userpin.setMap(e.map),e.userpin.setPosition(t),jk64plugin_setCircle(e,t)):(apex.debug(e.regionId+" create userpin "+i+","+n),e.userpin=new google.maps.Marker({map:e.map,position:t,icon:e.icon}),jk64plugin_setCircle(e,t))}}else e.userpin&&(apex.debug(e.regionId+" move existing pin off the map"),e.userpin.setMap(null),e.distcircle&&(apex.debug(e.regionId+" move distcircle off the map"),e.distcircle.setMap(null)))}function jk64plugin_initMap(e){apex.debug(e.regionId+" initMap");var i={zoom:1,center:new google.maps.LatLng(e.latlng),mapTypeId:google.maps.MapTypeId.ROADMAP};if(e.map=new google.maps.Map(document.getElementById(e.container),i),e.map.fitBounds(new google.maps.LatLngBounds(e.southwest,e.northeast)),""!==e.syncItem){var n=$v(e.syncItem);if(null!==n&&n.indexOf(",")>-1){var a=n.split(",");apex.debug(e.regionId+" init from item "+n);var t=new google.maps.LatLng(a[0],a[1]);e.userpin=new google.maps.Marker({map:e.map,position:t,icon:e.icon}),jk64plugin_setCircle(e,t)}$("#"+e.syncItem).change(function(){var i=this.value;if(null!==i&&void 0!==i&&i.indexOf(",")>-1){apex.debug(e.regionId+" item changed "+i);var n=i.split(",");jk64plugin_userPin(e,n[0],n[1])}})}if(""!=e.distItem&&$("#"+e.distItem).change(function(){if(this.value){var i=1e3*parseFloat(this.value);e.distcircle.getRadius()!==i&&(apex.debug(e.regionId+" distitem changed "+this.value),e.distcircle.setRadius(i))}else e.distcircle&&(apex.debug(e.regionId+" distitem cleared"),e.distcircle.setMap(null))}),jk64plugin_repPins(e),google.maps.event.addListener(e.map,"click",function(i){var n=i.latLng.lat(),a=i.latLng.lng();apex.debug(e.regionId+" map clicked "+n+","+a),""!==e.syncItem&&(jk64plugin_userPin(e,n,a),$s(e.syncItem,n+","+a),jk64plugin_refreshMap(e)),apex.jQuery("#"+e.regionId).trigger("mapclick",{map:e.map,lat:n,lng:a})}),""!=e.geocodeItem){var r=new google.maps.Geocoder;$("#"+e.geocodeItem).change(function(){jk64plugin_geocode(e,r)})}apex.debug(e.regionId+" initMap finished"),apex.jQuery("#"+e.regionId).trigger("maploaded",{map:e.map})}function jk64plugin_refreshMap(e){apex.debug(e.regionId+" refreshMap"),apex.jQuery("#"+e.regionId).trigger("apexbeforerefresh"),apex.server.plugin(e.ajaxIdentifier,{pageItems:e.ajaxItems},{dataType:"json",success:function(i){apex.debug(e.regionId+" success pData="+i.southwest.lat+","+i.southwest.lng+" "+i.northeast.lat+","+i.northeast.lng),e.map.fitBounds({south:i.southwest.lat,west:i.southwest.lng,north:i.northeast.lat,east:i.northeast.lng}),e.iw&&e.iw.close(),apex.debug(e.regionId+" remove all report pins");for(var n=0;n<e.reppin.length;n++)e.reppin[n].marker.setMap(null);if(apex.debug(e.regionId+" pData.mapdata.length="+i.mapdata.length),e.mapdata=i.mapdata,jk64plugin_repPins(e),""!==e.syncItem){var a=$v(e.syncItem);if(null!==a&&a.indexOf(",")>-1){var t=a.split(",");apex.debug(e.regionId+" init from item "+a),jk64plugin_userPin(e,t[0],t[1])}}apex.jQuery("#"+e.regionId).trigger("apexafterrefresh")}}),apex.debug(e.regionId+" refreshMap finished")}