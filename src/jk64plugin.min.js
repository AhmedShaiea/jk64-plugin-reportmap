function jk64plugin_geocode(e,i){i.geocode({address:$v(e.geocodeItem),componentRestrictions:""!==e.country?{country:e.country}:{}},function(i,t){if(t===google.maps.GeocoderStatus.OK){var a=i[0].geometry.location;apex.debug(e.regionId+" geocode ok"),e.map.setCenter(a),e.map.panTo(a),e.markerZoom&&e.map.setZoom(e.markerZoom),jk64plugin_userPin(e,a.lat(),a.lng()),e.addressItem&&$s(e.addressItem,i[0].formatted_address),apex.debug(e.regionId+" addressfound '"+i[0].formatted_address+"'"),apex.jQuery("#"+e.regionId).trigger("addressfound",{map:e.map,lat:a.lat(),lng:a.lng(),formatted_address:i[0].formatted_address})}else apex.debug(e.regionId+" geocode was unsuccessful for the following reason: "+t)})}function jk64plugin_markerclick(e,i){""!==e.idItem&&$s(e.idItem,i.id),apex.jQuery("#"+e.regionId).trigger("markerclick",{map:e.map,id:i.id,name:i.name,lat:i.lat,lng:i.lng,rad:i.rad,attr01:i.attr01,attr02:i.attr02,attr03:i.attr03,attr04:i.attr04,attr05:i.attr05,attr06:i.attr06,attr07:i.attr07,attr08:i.attr08,attr09:i.attr09,attr10:i.attr10})}function jk64plugin_repPin(e,i){var t=new google.maps.LatLng(i.lat,i.lng);if(i.rad){var a=new google.maps.Circle({strokeColor:i.col,strokeOpacity:1,strokeWeight:1,fillColor:i.col,fillOpacity:i.trns,clickable:!0,map:e.map,center:t,radius:1e3*i.rad});google.maps.event.addListener(a,"click",function(){apex.debug(e.regionId+" circle clicked "+i.id),jk64plugin_markerclick(e,i)}),e.circles||(e.circles=[]),e.circles.push({id:i.id,circ:a})}else{var n=new google.maps.Marker({map:e.map,position:t,title:i.name,icon:i.icon,label:i.label});google.maps.event.addListener(n,"click",function(){apex.debug(e.regionId+" repPin clicked "+i.id),i.info&&(e.iw?e.iw.close():e.iw=new google.maps.InfoWindow,e.iw.setOptions({content:i.info}),e.iw.open(e.map,this)),e.map.panTo(this.getPosition()),e.markerZoom&&e.map.setZoom(e.markerZoom),jk64plugin_markerclick(e,i)}),e.reppin||(e.reppin=[]),e.reppin.push({id:i.id,marker:n})}}function jk64plugin_repPins(e){if(e.mapdata.length>0){e.infoNoDataFound&&(apex.debug(e.regionId+" hide No Data Found infowindow"),e.infoNoDataFound.close());for(var i=0;i<e.mapdata.length;i++)jk64plugin_repPin(e,e.mapdata[i])}else""!==e.noDataMessage&&(apex.debug(e.regionId+" show No Data Found infowindow"),e.infoNoDataFound?e.infoNoDataFound.close():e.infoNoDataFound=new google.maps.InfoWindow({content:e.noDataMessage,position:{lat:0,lng:0}}),e.infoNoDataFound.open(e.map))}function jk64plugin_click(e,i){for(var t=!1,a=0;a<e.reppin.length;a++)if(e.reppin[a].id==i){new google.maps.event.trigger(e.reppin[a].marker,"click"),t=!0;break}t||apex.debug(e.regionId+" id not found:"+i)}function jk64plugin_setCircle(e,i){if(""!==e.distItem)if(e.distcircle)apex.debug(e.regionId+" move circle"),e.distcircle.setCenter(i),e.distcircle.setMap(e.map);else{var t=parseFloat($v(e.distItem));apex.debug(e.regionId+" create circle radius="+t),e.distcircle=new google.maps.Circle({strokeColor:"#5050FF",strokeOpacity:.5,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.05,clickable:!1,editable:!0,map:e.map,center:i,radius:1e3*t}),google.maps.event.addListener(e.distcircle,"radius_changed",function(i){var t=e.distcircle.getRadius()/1e3;apex.debug(e.regionId+" circle radius changed "+t),$s(e.distItem,t),jk64plugin_refreshMap(e)}),google.maps.event.addListener(e.distcircle,"center_changed",function(i){var t=e.distcircle.getCenter(),a=t.lat()+","+t.lng();apex.debug(e.regionId+" circle center changed "+a),""!==e.syncItem&&($s(e.syncItem,a),jk64plugin_refreshMap(e))})}}function jk64plugin_userPin(e,i,t){if(null!==i&&null!==t){var a=e.userpin?e.userpin.getPosition():new google.maps.LatLng(0,0);if(i==a.lat()&&t==a.lng())apex.debug(e.regionId+" userpin not changed");else{var n=new google.maps.LatLng(i,t);e.userpin?(apex.debug(e.regionId+" move existing pin to new position on map "+i+","+t),e.userpin.setMap(e.map),e.userpin.setPosition(n),jk64plugin_setCircle(e,n)):(apex.debug(e.regionId+" create userpin "+i+","+t),e.userpin=new google.maps.Marker({map:e.map,position:n,icon:e.icon}),jk64plugin_setCircle(e,n))}}else e.userpin&&(apex.debug(e.regionId+" move existing pin off the map"),e.userpin.setMap(null),e.distcircle&&(apex.debug(e.regionId+" move distcircle off the map"),e.distcircle.setMap(null)))}function jk64plugin_getAddress(e,i,t){var a={lat:i,lng:t};e.geocoder.geocode({location:a},function(a,n){n===google.maps.GeocoderStatus.OK?a[1]?($s(e.addressItem,a[0].formatted_address),apex.debug(e.regionId+" addressfound '"+a[0].formatted_address+"'"),apex.jQuery("#"+e.regionId).trigger("addressfound",{map:e.map,lat:i,lng:t,formatted_address:a[0].formatted_address})):window.alert("No results found"):window.alert("Geocoder failed due to: "+n)})}function jk64plugin_geolocate(e){navigator.geolocation?(apex.debug(e.regionId+" geolocate"),navigator.geolocation.getCurrentPosition(function(i){var t={lat:i.coords.latitude,lng:i.coords.longitude};e.map.panTo(t),e.geolocateZoom&&e.map.setZoom(e.geolocateZoom),apex.jQuery("#"+e.regionId).trigger("geolocate",{map:e.map,lat:t.lat,lng:t.lng})})):apex.debug(e.regionId+" browser does not support geolocation")}function jk64plugin_convertLatLng(e){var i=e.split(",");return 2!=i.length||isNaN(i[0])||isNaN(i[1])?e:{lat:parseFloat(i[0]),lng:parseFloat(i[1])}}function jk64plugin_directions(e){apex.debug(e.regionId+" directions");var i=jk64plugin_convertLatLng($v(e.originItem)),t=jk64plugin_convertLatLng($v(e.destItem));""!==i&&""!==t&&e.directionsService.route({origin:i,destination:t,travelMode:google.maps.TravelMode[e.directions]},function(i,t){if(t==google.maps.DirectionsStatus.OK){if(e.directionsDisplay.setDirections(i),""!==e.dirdistItem||""!==e.dirdurItem){for(var a=0,n=0,o=0;o<i.routes.length;o++)for(var r=0;r<i.routes[o].legs.length;r++){var s=i.routes[o].legs[r];a+=s.distance.value,n+=s.duration.value}""!==e.dirdistItem&&$s(e.dirdistItem,a),""!==e.dirdurItem&&$s(e.dirdurItem,n)}}else window.alert("Directions request failed due to "+t)})}function jk64plugin_initMap(e){apex.debug(e.regionId+" initMap");var i={zoom:1,center:new google.maps.LatLng(e.latlng),mapTypeId:google.maps.MapTypeId.ROADMAP};if(e.map=new google.maps.Map(document.getElementById(e.container),i),e.mapstyle&&e.map.setOptions({styles:e.mapstyle}),e.map.fitBounds(new google.maps.LatLngBounds(e.southwest,e.northeast)),""!==e.syncItem){var t=$v(e.syncItem);if(null!==t&&t.indexOf(",")>-1){var a=t.split(",");apex.debug(e.regionId+" init from item "+t);var n=new google.maps.LatLng(a[0],a[1]);e.userpin=new google.maps.Marker({map:e.map,position:n,icon:e.icon}),jk64plugin_setCircle(e,n)}$("#"+e.syncItem).change(function(){var i=this.value;if(null!==i&&void 0!==i&&i.indexOf(",")>-1){apex.debug(e.regionId+" item changed "+i);var t=i.split(",");jk64plugin_userPin(e,t[0],t[1])}})}if(""!=e.distItem&&$("#"+e.distItem).change(function(){if(this.value){var i=1e3*parseFloat(this.value);e.distcircle.getRadius()!==i&&(apex.debug(e.regionId+" distitem changed "+this.value),e.distcircle.setRadius(i))}else e.distcircle&&(apex.debug(e.regionId+" distitem cleared"),e.distcircle.setMap(null))}),e.expectData&&jk64plugin_repPins(e),""!==e.addressItem&&(e.geocoder=new google.maps.Geocoder),e.directions&&(e.directionsDisplay=new google.maps.DirectionsRenderer,e.directionsService=new google.maps.DirectionsService,e.directionsDisplay.setMap(e.map),jk64plugin_directions(e),$("#"+e.originItem).change(function(){jk64plugin_directions(e)}),$("#"+e.destItem).change(function(){jk64plugin_directions(e)})),google.maps.event.addListener(e.map,"click",function(i){var t=i.latLng.lat(),a=i.latLng.lng();apex.debug(e.regionId+" map clicked "+t+","+a),(""!==e.syncItem||""!==e.addressItem)&&jk64plugin_userPin(e,t,a),""!==e.syncItem?($s(e.syncItem,t+","+a),jk64plugin_refreshMap(e)):e.markerZoom&&(apex.debug(e.regionId+" pan+zoom"),e.map.panTo(i.latLng),e.map.setZoom(e.markerZoom)),""!==e.addressItem&&jk64plugin_getAddress(e,t,a),apex.jQuery("#"+e.regionId).trigger("mapclick",{map:e.map,lat:t,lng:a})}),""!=e.geocodeItem){var o=new google.maps.Geocoder;$("#"+e.geocodeItem).change(function(){jk64plugin_geocode(e,o)})}e.geolocate&&jk64plugin_geolocate(e),apex.debug(e.regionId+" initMap finished"),apex.jQuery("#"+e.regionId).trigger("maploaded",{map:e.map})}function jk64plugin_refreshMap(e){apex.debug(e.regionId+" refreshMap"),apex.jQuery("#"+e.regionId).trigger("apexbeforerefresh"),apex.server.plugin(e.ajaxIdentifier,{pageItems:e.ajaxItems},{dataType:"json",success:function(i){if(apex.debug(e.regionId+" success pData="+i.southwest.lat+","+i.southwest.lng+" "+i.northeast.lat+","+i.northeast.lng),e.map.fitBounds({south:i.southwest.lat,west:i.southwest.lng,north:i.northeast.lat,east:i.northeast.lng}),e.iw&&e.iw.close(),e.reppin){apex.debug(e.regionId+" remove all report pins");for(var t=0;t<e.reppin.length;t++)e.reppin[t].marker.setMap(null);e.reppin["delete"]}if(e.circles){apex.debug(e.regionId+" remove all circles");for(var t=0;t<e.circles.length;t++)e.circles[t].circ.setMap(null);e.circles["delete"]}if(apex.debug(e.regionId+" pData.mapdata.length="+i.mapdata.length),e.mapdata=i.mapdata,e.expectData&&jk64plugin_repPins(e),""!==e.syncItem){var a=$v(e.syncItem);if(null!==a&&a.indexOf(",")>-1){var n=a.split(",");apex.debug(e.regionId+" init from item "+a),jk64plugin_userPin(e,n[0],n[1])}}apex.jQuery("#"+e.regionId).trigger("apexafterrefresh")}}),apex.debug(e.regionId+" refreshMap finished")}