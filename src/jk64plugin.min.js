function jk64plugin_geocode(e,a){a.geocode({address:$v(e.geocodeItem),componentRestrictions:""!==e.country?{country:e.country}:{}},function(a,i){if(i===google.maps.GeocoderStatus.OK){var n=a[0].geometry.location;apex.debug(e.regionId+" geocode ok"),e.map.setCenter(n),e.map.panTo(n),e.markerZoom&&e.map.setZoom(e.markerZoom),jk64plugin_userPin(e,n.lat(),n.lng())}else apex.debug(e.regionId+" geocode was unsuccessful for the following reason: "+i)})}function jk64plugin_markerclick(e,a){""!==e.idItem&&$s(e.idItem,a.id),apex.jQuery("#"+e.regionId).trigger("markerclick",{map:e.map,id:a.id,name:a.name,lat:a.lat,lng:a.lng,rad:a.rad,attr01:a.attr01,attr02:a.attr02,attr03:a.attr03,attr04:a.attr04,attr05:a.attr05,attr06:a.attr06,attr07:a.attr07,attr08:a.attr08,attr09:a.attr09,attr10:a.attr10})}function jk64plugin_repPin(e,a){var i=new google.maps.LatLng(a.lat,a.lng);if(a.rad){var n=new google.maps.Circle({strokeColor:a.col,strokeOpacity:1,strokeWeight:1,fillColor:a.col,fillOpacity:a.trns,clickable:!0,map:e.map,center:i,radius:1e3*a.rad});google.maps.event.addListener(n,"click",function(){apex.debug(e.regionId+" circle clicked "+a.id),jk64plugin_markerclick(e,a)}),e.circles||(e.circles=[]),e.circles.push({id:a.id,circ:n})}else{var t=new google.maps.Marker({map:e.map,position:i,title:a.name,icon:a.icon});google.maps.event.addListener(t,"click",function(){apex.debug(e.regionId+" repPin clicked "+a.id),a.info&&(e.iw?e.iw.close():e.iw=new google.maps.InfoWindow,e.iw.setOptions({content:a.info}),e.iw.open(e.map,this)),e.map.panTo(this.getPosition()),e.markerZoom&&e.map.setZoom(e.markerZoom),jk64plugin_markerclick(e,a)}),e.reppin||(e.reppin=[]),e.reppin.push({id:a.id,marker:t})}}function jk64plugin_repPins(e){if(e.mapdata.length>0){e.infoNoDataFound&&(apex.debug(e.regionId+" hide No Data Found infowindow"),e.infoNoDataFound.close());for(var a=0;a<e.mapdata.length;a++)jk64plugin_repPin(e,e.mapdata[a])}else""!==e.noDataMessage&&(apex.debug(e.regionId+" show No Data Found infowindow"),e.infoNoDataFound?e.infoNoDataFound.close():e.infoNoDataFound=new google.maps.InfoWindow({content:e.noDataMessage,position:{lat:0,lng:0}}),e.infoNoDataFound.open(e.map))}function jk64plugin_click(e,a){for(var i=!1,n=0;n<e.reppin.length;n++)if(e.reppin[n].id==a){new google.maps.event.trigger(e.reppin[n].marker,"click"),i=!0;break}i||apex.debug(e.regionId+" id not found:"+a)}function jk64plugin_setCircle(e,a){if(""!==e.distItem)if(e.distcircle)apex.debug(e.regionId+" move circle"),e.distcircle.setCenter(a),e.distcircle.setMap(e.map);else{var i=parseFloat($v(e.distItem));apex.debug(e.regionId+" create circle radius="+i),e.distcircle=new google.maps.Circle({strokeColor:"#5050FF",strokeOpacity:.5,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.05,clickable:!1,editable:!0,map:e.map,center:a,radius:1e3*i}),google.maps.event.addListener(e.distcircle,"radius_changed",function(a){var i=e.distcircle.getRadius()/1e3;apex.debug(e.regionId+" circle radius changed "+i),$s(e.distItem,i),jk64plugin_refreshMap(e)}),google.maps.event.addListener(e.distcircle,"center_changed",function(a){var i=e.distcircle.getCenter(),n=i.lat()+","+i.lng();apex.debug(e.regionId+" circle center changed "+n),""!==e.syncItem&&($s(e.syncItem,n),jk64plugin_refreshMap(e))})}}function jk64plugin_userPin(e,a,i){if(null!==a&&null!==i){var n=e.userpin?e.userpin.getPosition():new google.maps.LatLng(0,0);if(a==n.lat()&&i==n.lng())apex.debug(e.regionId+" userpin not changed");else{var t=new google.maps.LatLng(a,i);e.userpin?(apex.debug(e.regionId+" move existing pin to new position on map "+a+","+i),e.userpin.setMap(e.map),e.userpin.setPosition(t),jk64plugin_setCircle(e,t)):(apex.debug(e.regionId+" create userpin "+a+","+i),e.userpin=new google.maps.Marker({map:e.map,position:t,icon:e.icon}),jk64plugin_setCircle(e,t))}}else e.userpin&&(apex.debug(e.regionId+" move existing pin off the map"),e.userpin.setMap(null),e.distcircle&&(apex.debug(e.regionId+" move distcircle off the map"),e.distcircle.setMap(null)))}function jk64plugin_getAddress(e,a,i){var n={lat:a,lng:i};e.geocoder.geocode({location:n},function(a,i){i===google.maps.GeocoderStatus.OK?a[1]?$s(e.addressItem,a[0].formatted_address):window.alert("No results found"):window.alert("Geocoder failed due to: "+i)})}function jk64plugin_geolocate(e){navigator.geolocation?(apex.debug(e.regionId+" geolocate"),navigator.geolocation.getCurrentPosition(function(a){var i={lat:a.coords.latitude,lng:a.coords.longitude};e.map.panTo(i),e.geolocateZoom&&e.map.setZoom(e.geolocateZoom),apex.jQuery("#"+e.regionId).trigger("geolocate",{map:e.map,lat:i.lat,lng:i.lng})})):apex.debug(e.regionId+" browser does not support geolocation")}function jk64plugin_initMap(e){apex.debug(e.regionId+" initMap");var a={zoom:1,center:new google.maps.LatLng(e.latlng),mapTypeId:google.maps.MapTypeId.ROADMAP};if(e.map=new google.maps.Map(document.getElementById(e.container),a),e.mapstyle&&e.map.setOptions({styles:e.mapstyle}),e.map.fitBounds(new google.maps.LatLngBounds(e.southwest,e.northeast)),""!==e.syncItem){var i=$v(e.syncItem);if(null!==i&&i.indexOf(",")>-1){var n=i.split(",");apex.debug(e.regionId+" init from item "+i);var t=new google.maps.LatLng(n[0],n[1]);e.userpin=new google.maps.Marker({map:e.map,position:t,icon:e.icon}),jk64plugin_setCircle(e,t)}$("#"+e.syncItem).change(function(){var a=this.value;if(null!==a&&void 0!==a&&a.indexOf(",")>-1){apex.debug(e.regionId+" item changed "+a);var i=a.split(",");jk64plugin_userPin(e,i[0],i[1])}})}if(""!=e.distItem&&$("#"+e.distItem).change(function(){if(this.value){var a=1e3*parseFloat(this.value);e.distcircle.getRadius()!==a&&(apex.debug(e.regionId+" distitem changed "+this.value),e.distcircle.setRadius(a))}else e.distcircle&&(apex.debug(e.regionId+" distitem cleared"),e.distcircle.setMap(null))}),e.expectData&&jk64plugin_repPins(e),""!==e.addressItem&&(e.geocoder=new google.maps.Geocoder),google.maps.event.addListener(e.map,"click",function(a){var i=a.latLng.lat(),n=a.latLng.lng();apex.debug(e.regionId+" map clicked "+i+","+n),(""!==e.syncItem||""!==e.addressItem)&&jk64plugin_userPin(e,i,n),""!==e.syncItem?($s(e.syncItem,i+","+n),jk64plugin_refreshMap(e)):e.markerZoom&&(apex.debug(e.regionId+" pan+zoom"),e.map.panTo(a.latLng),e.map.setZoom(e.markerZoom)),""!==e.addressItem&&jk64plugin_getAddress(e,i,n),apex.jQuery("#"+e.regionId).trigger("mapclick",{map:e.map,lat:i,lng:n})}),""!=e.geocodeItem){var o=new google.maps.Geocoder;$("#"+e.geocodeItem).change(function(){jk64plugin_geocode(e,o)})}e.geolocate&&jk64plugin_geolocate(e),apex.debug(e.regionId+" initMap finished"),apex.jQuery("#"+e.regionId).trigger("maploaded",{map:e.map})}function jk64plugin_refreshMap(e){apex.debug(e.regionId+" refreshMap"),apex.jQuery("#"+e.regionId).trigger("apexbeforerefresh"),apex.server.plugin(e.ajaxIdentifier,{pageItems:e.ajaxItems},{dataType:"json",success:function(a){if(apex.debug(e.regionId+" success pData="+a.southwest.lat+","+a.southwest.lng+" "+a.northeast.lat+","+a.northeast.lng),e.map.fitBounds({south:a.southwest.lat,west:a.southwest.lng,north:a.northeast.lat,east:a.northeast.lng}),e.iw&&e.iw.close(),e.reppin){apex.debug(e.regionId+" remove all report pins");for(var i=0;i<e.reppin.length;i++)e.reppin[i].marker.setMap(null);e.reppin["delete"]}if(e.circles){apex.debug(e.regionId+" remove all circles");for(var i=0;i<e.circles.length;i++)e.circles[i].circ.setMap(null);e.circles["delete"]}if(apex.debug(e.regionId+" pData.mapdata.length="+a.mapdata.length),e.mapdata=a.mapdata,e.expectData&&jk64plugin_repPins(e),""!==e.syncItem){var n=$v(e.syncItem);if(null!==n&&n.indexOf(",")>-1){var t=n.split(",");apex.debug(e.regionId+" init from item "+n),jk64plugin_userPin(e,t[0],t[1])}}apex.jQuery("#"+e.regionId).trigger("apexafterrefresh")}}),apex.debug(e.regionId+" refreshMap finished")}